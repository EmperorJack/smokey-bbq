#include <imgui.h>
#include <audio_analyzer/audio_analyzer_gui.hpp>

std::vector<std::pair<int, const char*>> inputDevices;

AudioAnalyzerGui::AudioAnalyzerGui(AudioAnalyzer *audioAnalyzer) {
    this->audioAnalyzer = audioAnalyzer;
    inputDevices = audioAnalyzer->getInputDevices();
}

void AudioAnalyzerGui::render() {
    ImGui::Begin("Audio Analyzer");

    renderDeviceSelector();
    ImGui::Separator();
    renderToggles();
    ImGui::Separator();
    renderVariables();

    ImGui::End();
}

void AudioAnalyzerGui::renderDeviceSelector() {
    ImGui::Text("Input Devices");

    static int select = 0;

    for (int i = 0; i < inputDevices.size(); i++) {
        ImGui::RadioButton(inputDevices[i].second, &select, inputDevices[i].first);
    }

    if (ImGui::Button("Apply")) audioAnalyzer->openDevice(select);
}

void AudioAnalyzerGui::renderToggles() {
    ImGui::Checkbox("Display Waveform", &audioAnalyzer->displayWaveform);
    ImGui::Checkbox("Display Frequency Spectrum", &audioAnalyzer->displaySpectrum);
    ImGui::Checkbox("Display Frequency Bands", &audioAnalyzer->displayFrequencyBands);
    ImGui::Checkbox("Display Volume Level", &audioAnalyzer->displayVolumeLevel);
    ImGui::Checkbox("Update Analyzer", &audioAnalyzer->updateAnalyzer);
    ImGui::Checkbox("Log Scale Bands", &audioAnalyzer->logScaleBands);

    ImGui::Separator(); // Reset toggles

    if (ImGui::Button("Reset Toggles")) audioAnalyzer->setDefaultToggles();
}

void AudioAnalyzerGui::renderVariables() {
    ImGui::Text("Frequency Damping");
    ImGui::SliderFloat("##FREQUENCY_DAMPING", &audioAnalyzer->frequencyDamping, 0.5f, 1.0f, "%.3f");

    ImGui::Text("Frequency Band Scale");
    ImGui::SliderFloat("##frequencyScale", &audioAnalyzer->frequencyScale, 0.01f, 1.0f, "%.3f");

    ImGui::Text("Overall Volume Scale");
    ImGui::SliderFloat("##volumeScale", &audioAnalyzer->volumeScale, 0.01f, 1.0f, "%.3f");

    ImGui::Separator(); // Reset variables

    if (ImGui::Button("Reset Variables")) audioAnalyzer->setDefaultVariables();
}
